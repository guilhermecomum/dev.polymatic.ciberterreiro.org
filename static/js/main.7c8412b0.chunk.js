(this.webpackJsonpPolymatic=this.webpackJsonpPolymatic||[]).push([[0],{111:function(e,t,a){},112:function(e,t,a){},113:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),i=a(23),s=a.n(i),o=(a(87),a(7)),c=a(38),l=a(18),u=a(44),m=a(81),h=a(32),f=a.n(h),p=a(14),d=a(15),v=a(8),b=a.n(v),y=a(47),g=a.n(y).a.watch;function w(e,t){var a=this;return a._createSequence(e,t),g(this,["pulses","steps"],(function(){a.update(this.pulses,this.steps)})),this}w.prototype.update=function(e,t){return this._createSequence(e,t),this},w.prototype.shift=function(e){var t=e>this.seq.length?e-=this.seq.length:e;if(t===this.seq.length)return this;for(var a=this.seq.splice(this.seq.length-t,t),n=0;n<a.length;n++)this.seq.unshift(a[n]);return this},w.prototype._createSequence=function(e,t){var a=typeof e;return"number"===a?(this.pulses=e,this.steps=t||e,this.seq=f.a.getPattern(this.pulses,this.steps)):"string"===a&&(this.steps=e.length,this.seq=e.split("")),this};var k=w,E=a(48),x=a.n(E);function _(e,t){var a=this;if(!e)throw new Error("Context is mandatory");if(!t)throw new Error("Callback is mandatory");this.context=e,this.steps=16,this.tempo=120,this.callback=t,this.look_ahead=1,this._step=1,this._scheduler_interval=20,this._next_event_time=0,this._first=!0,this._is_running=!1,this._worker=x()(98),this._worker.onmessage=function(e){"tick"===e.data&&a._is_running&&a._scheduler()},this._worker.postMessage({interval:a._scheduler_interval})}_.prototype.start=function(e){this._is_running?console.log("already started"):(this._is_running=!0,this._worker.postMessage("start"))},_.prototype.pause=function(){this._is_running=!1,this._worker.postMessage("stop")},_.prototype.stop=function(){this._first=!0,this._step=1,this._is_running=!1,this._worker.postMessage("stop")},_.prototype._scheduler=function(){for(1===this._step&&this._first&&(this._next_event_time=this.context.currentTime);this._next_event_time<this.context.currentTime+this.look_ahead;){var e=this._next_event_time-this.context.currentTime;this.callback(this._next_event_time,this._step,e),this._next()}},_.prototype._next=function(){this._step++,this._first&&(this._next_event_time=this.context.currentTime,this._first=!1),this._step>this.steps&&(this._step=1),this._next_event_time+=60/this.tempo*4/this.steps};var j=_,O=function(){function e(t,a,n,r,i,s){var o=this;Object(p.a)(this,e),this.id=t,this.on=s,this.tempo=n,this.clavis=r,this.context=a,this.sequence=i,this.metro=new j(a,(function(e,t,a){o.metro.steps!==o.sequence.seq.length&&(o.metro.steps=o.sequence.seq.length),"1"===i.seq[t-1]?(o.on(e,t,a),setTimeout((function(){r.setCurrentStep(t)}),1e3)):setTimeout((function(){r.setCurrentStep(t)}),1e3)})),this.metro.steps=i.seq.length,this.metro.tempo=this.tempo}return Object(d.a)(e,[{key:"start",value:function(){this.metro.start()}},{key:"pause",value:function(){this.metro.pause()}},{key:"stop",value:function(){this.metro.stop()}},{key:"watch",value:function(e){this.metro.tempo=e}}]),e}(),q=function(){function e(t){var a=t.context;Object(p.a)(this,e),this.context=a,this.tempo=120,this.layers=[]}return Object(d.a)(e,[{key:"layer",value:function(e,t,a,n){return new O(b.a.generate(),this.context,t,a,e,n)}},{key:"pattern",value:function(e,t){return new k(e,t)}},{key:"add",value:function(e){this.layers.push(e)}},{key:"remove",value:function(e){e.metro.stop(),this.layers=this.layers.filter((function(t){return t.id!==e.id}))}},{key:"start",value:function(){this.layers.forEach((function(e){e.start()}))}},{key:"pause",value:function(){this.layers.forEach((function(e){e.pause()}))}},{key:"load",value:function(e,t,a,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){e.decodeAudioData(r.response,a,n)},r.onerror=n,r.send()}},{key:"envelope",value:function(e,t,a){a||(a={});var n=a.peak||e.defaultValue;0===a.start&&(a.start=1e-6);var r=a.start||e.value,i=a.attack||.1,s=a.decay||0,o=a.sustain||n,c=a.release||.5;e.setValueAtTime(r,t),e.linearRampToValueAtTime(n,t+i),e.linearRampToValueAtTime(o,t+i+s),e.linearRampToValueAtTime(0,t+i+s+c)}},{key:"changeTempo",value:function(e){var t=!0,a=!1,n=void 0;try{for(var r,i=this.layers[Symbol.iterator]();!(t=(r=i.next()).done);t=!0){r.value.metro.tempo=e}}catch(s){a=!0,n=s}finally{try{t||null==i.return||i.return()}finally{if(a)throw n}}}}]),e}(),S=function(){function e(){Object(p.a)(this,e),this.canvas=null,this.context=null,this.pattern=null,this.tempo=0,this.animate=!1,this.lastRender=Date.now(),this.draw=this.draw.bind(this),this.currentStep=1,this.patternPos={}}return Object(d.a)(e,[{key:"configure",value:function(e,t,a){this.canvas=e,this.context=e.getContext("2d"),this.pattern=t,this.tempo=a}},{key:"setCurrentStep",value:function(e){this.currentStep=e}},{key:"play",value:function(){this.animate=!0,window.requestAnimationFrame(this.draw)}},{key:"pause",value:function(){this.animate=!1}},{key:"draw",value:function(){var e=this.canvas,t=this.context,a=this.pattern,n="20px",r=2,i="#fff",s="#cc2c11",c=4,l="#cc2c11",u="#cc2c11",m=2,h="#fff",f="#fff",p=8,d="#cc2c11",v="#cc2c11",b=[200,200],y=b[0],g=b[1],w=80,k=2*Math.PI/a.length,E=-.5*Math.PI;function x(e,a,n){var r=n.radius,i=n.stroke,s=n.fill;t.strokeStyle=i,t.fillStyle=s,t.beginPath(),t.arc(e,a,r,0,2*Math.PI),t.fill(),t.stroke()}function _(e,t){x(e,t,{radius:c,stroke:l,fill:u})}function j(e,t){x(e,t,{radius:m,stroke:h,fill:f})}e.style.padding=n,e.width=y,e.height=g,t.clearRect(0,0,y,g),t.lineWidth=r,t.strokeStyle=i,t.beginPath(),t.arc(y/2,g/2,w,0,2*Math.PI),t.stroke();var O=[];function q(e,t){return[Math.cos(e)*t+y/2,Math.sin(e)*t+g/2]}for(var S=0;S<a.length;S++){var C=q(E+k*S,w),P=Object(o.a)(C,2),T=P[0],A=P[1];"1"===a[S]?(_(T,A),O.push([T,A])):j(T,A),this.patternPos[S]={x:T,y:A}}O.length>=1&&function(e){t.strokeStyle=s,t.beginPath(),t.moveTo(e[0][0],e[0][1]);for(var a=1;a<e.length;a++)t.lineTo(e[a][0],e[a][1]);t.closePath(),t.stroke()}(O),function(e,t){x(e,t,{radius:p,stroke:d,fill:v})}(this.patternPos[this.currentStep-1].x,this.patternPos[this.currentStep-1].y),this.animate&&window.requestAnimationFrame(this.draw)}}]),e}(),C=function(){function e(){var t=this;Object(p.a)(this,e),this.callbackOn=function(e,a){var n=t.context.createGain();n.gain.value=t.volume,n.connect(t.context.destination);var r=t.context.createBufferSource();r.buffer=t.instrument,r.connect(n),r.start(e)},this.volume=1,this.context=null,this.beet=null,this.instrument=null}return Object(d.a)(e,[{key:"configure",value:function(e,t,a){this.context=e,this.beet=t,this.instrument=a}},{key:"setVolume",value:function(e){this.volume=e}},{key:"getVolume",value:function(){return this.volume}}]),e}(),P=a(49),T=a.n(P),A=(a(99),a(21)),M=a(22),N=a(115),R=a(51);function I(e){var t=e.guia,a=e.removeLayer,i=Object(n.useRef)(),s=Object(n.useState)(100),c=Object(o.a)(s,2),l=c[0],u=c[1],m=t.sequence,h=t.tempo,f=t.layer,p=t.clavis,d=t.channel;Object(n.useEffect)((function(){p.configure(i.current,m,h),p.play()}));return r.a.createElement("div",{className:"layer"},r.a.createElement("canvas",{id:b.a.generate(),ref:i,width:640,height:425}),r.a.createElement("ul",null,r.a.createElement("li",null,"sequence: ",m),r.a.createElement("li",null,"tempo: ",h)),a&&r.a.createElement("div",{className:"controls"},r.a.createElement(N.a,{"aria-label":"Basic example"},r.a.createElement(R.a,{onClick:function(){return f.start(),void p.play()}},r.a.createElement(A.a,{icon:M.a})),r.a.createElement(R.a,{onClick:function(){return f.stop(),void p.pause()}},r.a.createElement(A.a,{icon:M.b})),r.a.createElement(R.a,{onClick:function(){return a(t)}},r.a.createElement(A.a,{icon:M.c})))),r.a.createElement("div",{className:"mt-2"},r.a.createElement(T.a,{value:l,min:0,max:100,tooltipLabel:function(e){return"".concat(e,"%")},onChange:function(e){return function(e){var t=function(e,t,a,n,r){return n+(r-n)*(e-t)/(a-t)}(e,0,100,0,1);u(e),d.setVolume(t)}(Number(e.target.value))}})))}function B(e){e.preview;var t=e.sequence,a=e.clavis,i=Object(n.useRef)();return Object(n.useEffect)((function(){a.configure(i.current,t,120),a.draw()})),r.a.createElement("div",{className:"layer"},r.a.createElement("canvas",{id:b.a.generate(),ref:i,width:640,height:425}),r.a.createElement("p",{className:"Preview"},"Pr\xe9-visualiza\xe7\xe3o"))}var L,V=a(52),D=a.n(V),G=a(53),H=a.n(G),J=a(54),U=a.n(J),W=a(55),X=a.n(W),$=a(56),z=a.n($),F=a(57),K=a.n(F),Q=a(58),Y=a.n(Q),Z=a(59),ee=a.n(Z),te=a(60),ae=a.n(te),ne=a(61),re=a.n(ne),ie=a(62),se=a.n(ie),oe=a(63),ce=a.n(oe),le=a(64),ue=a.n(le),me=a(65),he=a.n(me),fe=a(66),pe=a.n(fe),de=a(67),ve=a.n(de),be=a(68),ye=a.n(be),ge=a(69),we=a.n(ge),ke=a(70),Ee=a.n(ke),xe={agogo1:D.a,agogo2:H.a,bass:U.a,block:X.a,bumbo:z.a,claves:K.a,conga1:Y.a,conga2:ee.a,cymbal:ae.a,djembe1:re.a,djembe2:se.a,djembe3:ce.a,hit:ue.a,hithat:he.a,kick1:pe.a,kick2:ve.a,kicklow:ye.a,snare:we.a,tamborim:Ee.a},_e=a(41),je=(L={},Object(_e.a)(L,b.a.generate(),{name:"Rumba",instruments:[{sequence:"1001000100101000",tempo:120,sample:"conga1"}]}),Object(_e.a)(L,b.a.generate(),{name:"Centro de gravidade",instruments:[{sequence:"10101",tempo:120,sample:"bumbo"},{sequence:"10110101",tempo:120,sample:"bass"}]}),L),Oe=a(116),qe=a(71),Se=a(119),Ce=a(117);var Pe=function(e){var t=e.layers,a=(e.beet,e.pattern),i=e.setPattern,s=e.patternError,c=e.sequence,l=(e.setPreview,e.handleStoreUpdate),u=Object(n.useState)("agogo1"),m=Object(o.a)(u,2),h=m[0],f=m[1],p=Object(n.useState)(120),d=Object(o.a)(p,2),v=d[0],y=d[1];return r.a.createElement("div",{className:"toolbar"},r.a.createElement("div",{className:"toolbar-controls"},r.a.createElement(N.a,{"aria-label":"Basic example"},r.a.createElement(R.a,{variant:"secondary",onClick:function(){return function(){var e=!0,a=!1,n=void 0;try{for(var r,i=t[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var s=r.value;s.layer.start(),s.clavis.play()}}catch(o){a=!0,n=o}finally{try{e||null==i.return||i.return()}finally{if(a)throw n}}}()}},r.a.createElement(A.a,{icon:M.a})),r.a.createElement(R.a,{variant:"secondary",onClick:function(){return function(){var e=!0,a=!1,n=void 0;try{for(var r,i=t[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var s=r.value;s.layer.stop(),s.clavis.pause()}}catch(o){a=!0,n=o}finally{try{e||null==i.return||i.return()}finally{if(a)throw n}}}()}},r.a.createElement(A.a,{icon:M.b})))),r.a.createElement("div",{className:"toolbar-form"},r.a.createElement(Oe.a,null,r.a.createElement(Oe.a.Prepend,null,r.a.createElement(Oe.a.Text,{id:"basic-addon3"},"Padr\xe3o")),r.a.createElement(qe.a,{placeholder:"1010101 ou 3,4",value:a,onChange:function(e){return i(e.target.value)},isInvalid:a.length>0&&s})),r.a.createElement(Oe.a,null,r.a.createElement(Oe.a.Prepend,null,r.a.createElement(Oe.a.Text,{id:"basic-addon3"},"Tempo")),r.a.createElement(qe.a,{placeholder:"tempo",value:v,onChange:function(e){return y(e.target.value)}})),r.a.createElement(Se.a.Control,{as:"select",onChange:function(e){return f(e.target.value)}},r.a.createElement("option",null,"Instrumentos"),Object.keys(xe).map((function(e,t){return r.a.createElement("option",{key:t,value:e},e)}))),r.a.createElement(R.a,{className:"ml-2",onClick:function(){return function(){var e={name:b.a.generate(),instruments:[{sequence:c,tempo:v,sample:h}]};l(e)}()},disabled:s},"Adicionar"),r.a.createElement(Ce.a,{className:"ml-2"},r.a.createElement(Ce.a.Toggle,{variant:"info",id:"dropdown-basic"},"presets"),r.a.createElement(Ce.a.Menu,null,Object.keys(je).map((function(e,t){return r.a.createElement(Ce.a.Item,{key:t,onClick:function(){l(je[e])}},je[e].name)}))))))};var Te=function(e){var t=e.context,a=e.instruments,i=Object(n.useState)([]),s=Object(o.a)(i,2),c=s[0],l=s[1],u=Object(n.useState)(!0),h=Object(o.a)(u,2),p=h[0],d=h[1],v=Object(n.useState)(""),y=Object(o.a)(v,2),g=y[0],w=y[1],k=Object(n.useState)(!1),E=Object(o.a)(k,2),x=E[0],_=E[1],j=Object(n.useState)(""),O=Object(o.a)(j,2),P=O[0],T=O[1],A=Object(n.useState)([]),M=Object(o.a)(A,2),N=M[0],R=M[1],L=new q({context:t});Object(n.useEffect)((function(){!function(e){var t=new RegExp("^(\\d+(\\.\\d+)?),(\\d+(\\.\\d+)?)$"),a=new RegExp("^[0-1]{1,}$");if(t.test(g)){var n=e.split(",").map((function(e){return parseInt(e)})).sort((function(e,t){return e-t})),r=Object(o.a)(n,2),i=r[0],s=r[1],c=f.a.getPattern(i,s).join("");T(c),d(!0),_(!1)}else a.test(g)?(T(g),d(!0),_(!1)):(""===e&&T(""),d(!1),_(!0))}(g)}),[P,g]);var V=function(e,t,a,n,r){l((function(i){return i.concat({id:b.a.generate(),sequence:e,tempo:t,layer:a,clavis:n,channel:r})}))},D=function(e){L.remove(e.layer),e.clavis.pause(),l(c.filter((function(t){return t.id!==e.id})))},G={layers:c,beet:L,pattern:g,setPattern:w,patternError:x,sequence:P,setPreview:d,handleStoreUpdate:function(e){e.instruments.forEach((function(e){var n=e.sequence,r=e.tempo,i=e.sample;R([].concat(Object(m.a)(N),[{sequence:n,tempo:r,sample:i}])),function(e,n,r){d(!1);var i=L.pattern(e),s=new S,o=new C;o.configure(t,L,a[r]);var c={layer:L.layer(i,n,s,o.callbackOn)};c.layer.tempo=n,L.add(c.layer),V(e,n,c.layer,s,o)}(n,r,i)})),L.start()}};return r.a.createElement("div",{className:"App"},r.a.createElement(Pe,G),r.a.createElement("div",{className:"wrapper"},c.map((function(e){return r.a.createElement(I,{key:e.id,guia:e,removeLayer:D})})),p&&P.length>0&&r.a.createElement(B,{sequence:P,clavis:new S})))},Ae=a(78),Me=a(118);var Ne=function(){return r.a.createElement(Me.a,{collapseOnSelect:!0,bg:"black",expand:"lg",variant:"black"},r.a.createElement(Me.a.Brand,null,r.a.createElement("h3",null,r.a.createElement(c.b,{to:"/"},"Polymatic ",r.a.createElement("small",null,Ae.version)))),r.a.createElement(Me.a.Toggle,{"aria-controls":"responsive-navbar-nav"}))},Re=function(){function e(t,a,n){Object(p.a)(this,e),this.context=t,this.instruments=a,this.onload=n,this.bufferList={},this.loadCount=0}return Object(d.a)(e,[{key:"loadBuffer",value:function(e,t){var a=this,n=new XMLHttpRequest;n.open("GET",this.instruments[e],!0),n.responseType="arraybuffer",n.onload=function(){a.context.decodeAudioData(n.response,(function(t){t?(a.bufferList[e]=t,++a.loadCount===Object.keys(a.instruments).length&&a.onload(a.bufferList)):alert("error decoding file data: "+e)}),(function(e){console.error("decodeAudioData error",e)}))},n.onerror=function(){alert("BufferLoader: XHR error")},n.send()}},{key:"load",value:function(){var e=this;Object.keys(this.instruments).forEach((function(t){e.loadBuffer(t)}))}}]),e}(),Ie=(a(111),a(112),new AudioContext);var Be=function(){var e=Object(n.useState)(),t=Object(o.a)(e,2),a=t[0],i=t[1];u.a.initialize("UA-160360260-2"),u.a.pageview(window.location.pathname+window.location.search),window.AudioContext=window.AudioContext||window.webkitAudioContext;var s=function(e){return i(e)};return Object(n.useEffect)((function(){new Re(Ie,xe,s).load()}),[]),r.a.createElement(c.a,{basename:"/"},r.a.createElement(Ne,null),r.a.createElement(l.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(Te,Object.assign({},e,{instruments:a,context:Ie}))}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(Be,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},52:function(e,t,a){e.exports=a.p+"static/media/agogo1.b8f6e210.wav"},53:function(e,t,a){e.exports=a.p+"static/media/agogo2.5844966c.wav"},54:function(e,t,a){e.exports=a.p+"static/media/bass.b2419d4f.wav"},55:function(e,t,a){e.exports=a.p+"static/media/block.3753c44b.wav"},56:function(e,t,a){e.exports=a.p+"static/media/bum.4c11d5fa.wav"},57:function(e,t,a){e.exports=a.p+"static/media/claves.400c9ef3.wav"},58:function(e,t,a){e.exports=a.p+"static/media/conga1.41b2f57f.wav"},59:function(e,t,a){e.exports=a.p+"static/media/conga2.887c0c16.wav"},60:function(e,t,a){e.exports=a.p+"static/media/cymbal.950d832b.wav"},61:function(e,t,a){e.exports=a.p+"static/media/djembe1.f3e648cb.wav"},62:function(e,t,a){e.exports=a.p+"static/media/djembe3.acef368f.wav"},63:function(e,t,a){e.exports=a.p+"static/media/djembe2.d38ab3d2.wav"},64:function(e,t,a){e.exports=a.p+"static/media/hit.a315148b.wav"},65:function(e,t,a){e.exports=a.p+"static/media/hithat.950d832b.wav"},66:function(e,t,a){e.exports=a.p+"static/media/kick1.e63d68a9.wav"},67:function(e,t,a){e.exports=a.p+"static/media/kick2.18445a5e.wav"},68:function(e,t,a){e.exports=a.p+"static/media/kicklow.c09eab14.wav"},69:function(e,t,a){e.exports=a.p+"static/media/snare.96dbe59f.wav"},70:function(e,t,a){e.exports=a.p+"static/media/tamborim.a6cbfb58.wav"},78:function(e){e.exports=JSON.parse('{"name":"Polymatic","version":"3.2.0","private":true,"homepage":"https://polymatic.ciberterreiro.org","dependencies":{"@fortawesome/fontawesome-svg-core":"^1.2.27","@fortawesome/free-solid-svg-icons":"^5.12.1","@fortawesome/react-fontawesome":"^0.1.9","@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.3.2","@testing-library/user-event":"^7.1.2","beet.js":"^1.7.0","bootstrap":"^4.4.1","euclidean-rhythms":"^2.0.1","gh-pages":"^2.2.0","melanke-watchjs":"^1.5.2","node-sass":"^4.13.1","react":"^16.13.0","react-bootstrap":"^1.0.0-beta.17","react-bootstrap-range-slider":"^0.3.1","react-dom":"^16.13.0","react-ga":"^2.7.0","react-router-dom":"^5.1.2","react-scripts":"3.4.0","shortid":"^2.2.15","watchjs":"^0.0.0","webworkify-webpack":"^2.1.5"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject","predeploy":"npm run build && cp CNAME build/CNAME","deploy":"gh-pages -b gh-pages -d build"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},82:function(e,t,a){e.exports=a(113)},87:function(e,t,a){},98:function(e,t,a){"use strict";a.r(t),t.default=function(e){var t=25,a=null;e.onmessage=function(e){"interval"===e.data&&(t=e.data.interval),"start"===e.data&&(a=setInterval((function(){postMessage("tick")}),t)),"stop"===e.data&&(clearInterval(a),a=null)}}}},[[82,1,2]]]);
//# sourceMappingURL=main.7c8412b0.chunk.js.map